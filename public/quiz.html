<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Racionais Mc's</title>
  <link rel="stylesheet" href="style/dash.css">
  <link rel="stylesheet" href="style/quiz.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <div class="container">
    <aside class="menu-lateral">
        <div class="menu-header">
          <img src="../public/assets/imgs/icone-logo.png" alt="Logo">
        </div>
        <div class="menu-opcoes">
          <a href="quiz.html"><img src="../public/assets/imgs/quiz.png" alt="Quiz"></a>
          <a href="../public/dashboard.html"><img src="../public/assets/imgs/grafico-dash.png" alt="Home" onclick="mostrarGeral()"></a>
          <!-- <a href="../public/dashboard.html"></a><img src="../public/assets/imgs/grafico-dash.png" alt="Gráficos" onclick="mostrarIndividual()"></a> -->
          <!-- <a href="index.html"><img src="/public/assets/imgs/sair.png" alt="Sair"></a> -->
       </div>
        <div class="menu-sair">
          <a href="../public/index.html"><img src="../public/assets/imgs/sair.png" alt="Sair"></a>
        </div>
      </aside>

  <div id="instrucoes">
    <h1>Bem-vindo ao Quiz Racionais Mc's!</h1>
    <p>Teste seus conhecimentos sobre o grupo! <br>
      Responda às perguntas e descubra sua pontuação ao final.</p>
    <button onclick="iniciarQuiz()">Iniciar Quiz</button>
  </div>

  <div id="quiz-container" style="display: none;">
    <!-- <h1>Quiz Racionais Mc's</h1> -->
    <div id="container-questoes"></div>
    <button id="proxima-button" onclick="proximaQuestao()" style="display: none;">Próxima</button>
  </div>

  <div id="resultado" style="display: none;">
    <h1>Quiz Finalizado!</h1>
    <p id="pontuacao"></p>
    <button onclick="reiniciarQuiz()">Reiniciar Quiz</button>
  </div>  
</body>

</html>
<script>
  let indiceQuestaoAtual = 0;
  let pontuacaoUsuario = 0;
  var idUsuario =  sessionStorage.ID_USUARIO;

  const questoes = [
    {
      questao: "Qual o ano de formação do grupo Racionais?",
      opcoes: ["1990", "1985", "1997", "1988"],
      resposta: "1988"
    },
    {
      questao: "Qual o nome do primeiro disco oficial lançado pelo grupo?",
      opcoes: ["Sobrevivendo no Inferno", "Cores e Valores", "Holocausto Urbano", "Racionais Mc's"],
      resposta: "Holocausto Urbano"
    },
    {
      questao: "Quantos integrantes possui o grupo?",
      opcoes: ["5", "3", "4", "6"],
      resposta: "4"
    },
    {
      questao: "Qual música do grupo representa o dia a dia na reclusão?",
      opcoes: ["Jesus Chorou", "Qual Mentira vou Acreditar", "Diário de um Detento", "Um Homem na Estrada"],
      resposta: "Diário de um Detento"
    }
  ];

  function iniciarQuiz() {
    document.getElementById("instrucoes").style.display = "none";
    document.getElementById("quiz-container").style.display = "block";
    mostrarQuestao();
  }

  function mostrarQuestao() {
    const containerQuestoes = document.getElementById('container-questoes');
    containerQuestoes.innerHTML = '';

    const dadosQuestao = questoes[indiceQuestaoAtual];
    const textoQuestao = document.createElement('h2');
    textoQuestao.textContent = dadosQuestao.questao;

    const containerOpcoes = document.createElement('div');
    dadosQuestao.opcoes.forEach(opcao => {
      const botaoOpcao = document.createElement('button');
      botaoOpcao.textContent = opcao;
      botaoOpcao.onclick = () => verificarResposta(opcao);
      containerOpcoes.appendChild(botaoOpcao);
    });

    containerQuestoes.appendChild(textoQuestao);
    containerQuestoes.appendChild(containerOpcoes);

    document.getElementById('proxima-button').style.display = 'none';
  }

  function verificarResposta(opcaoSelecionada) {
    const respostaCorreta = questoes[indiceQuestaoAtual].resposta;
    if (opcaoSelecionada === respostaCorreta) {
      alert('Resposta correta!');
      pontuacaoUsuario++;
    } else {
      alert(`Resposta errada! A correta é: ${respostaCorreta}`);
    }
    document.getElementById('proxima-button').style.display = 'block';
  }

  function proximaQuestao() {
    indiceQuestaoAtual++;
    if (indiceQuestaoAtual < questoes.length) {
      mostrarQuestao();
    } else {
      finalizarQuiz();
    }
  }

  function finalizarQuiz() {
  
    console.log(idUsuario , pontuacaoUsuario);


    document.getElementById("quiz-container").style.display = "none";
    document.getElementById("resultado").style.display = "block";

    const pontuacao = document.getElementById("pontuacao");
    pontuacao.textContent = `Você acertou ${pontuacaoUsuario} de ${questoes.length} perguntas!`;

    // Enviando o valor da nova input
    fetch(`/pontuacao/salvarPontuacao/${idUsuario}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        pontuacaoServer: pontuacaoUsuario,
        idUsuarioServer: idUsuario
      })
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          console.log('Pontuação inserida no banco de dados.')
        } else {
          console.log("Erro ao inserir pontuação no banco de dados.")
        }
      })
      
  } 

  function reiniciarQuiz() {
    indiceQuestaoAtual = 0;
    pontuacaoUsuario = 0;
    document.getElementById("resultado").style.display = "none";
    document.getElementById("instrucoes").style.display = "block";
  }

</script>